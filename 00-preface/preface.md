# 서문

## 이 책을 쓴 이유

.NET 개발자로 10년 이상 일하면서 다양한 프로젝트를 경험했습니다. 웹 애플리케이션, 데스크톱 프로그램, 클라우드 서비스까지. 하지만 어느 날 "파일 시스템 수준에서 데이터를 보호해야 한다"는 요구사항을 만났을 때, 익숙했던 모든 것이 무력해지는 경험을 했습니다.

Windows 커널 드라이버. 그것도 파일 시스템 필터 드라이버.

.NET의 편안한 품을 벗어나 C 언어와 커널 모드의 세계로 들어가야 했습니다. 당시 참고할 수 있는 한국어 자료는 거의 없었고, 영문 문서조차 단편적이었습니다. Microsoft의 공식 문서는 이미 알고 있는 사람을 위해 작성된 것처럼 느껴졌고, 커널 개발 경험이 없는 .NET 개발자가 참고하기에는 진입 장벽이 너무 높았습니다.

이 책은 그때의 저 자신에게 보내는 안내서입니다.

### 기존 자료의 한계

커널 드라이버 개발에 관한 기존 자료들은 대부분 다음과 같은 한계가 있습니다:

1. **C/C++ 개발자를 전제로 함**: 포인터, 메모리 관리, 빌드 시스템에 대한 설명이 없거나 부족합니다.
2. **단편적인 코드 조각**: 완전한 예제 없이 API 사용법만 나열합니다.
3. **디버깅 방법 부재**: BSOD(Blue Screen of Death)가 발생했을 때 어떻게 해야 하는지 알려주지 않습니다.
4. **실무 경험 부족**: 실제 제품에 적용할 때 고려해야 할 사항들이 빠져 있습니다.

### 실무 중심 가이드의 필요성

이 책은 이론보다 실습을, 완벽함보다 동작하는 코드를 우선합니다. 모든 개념은 실행 가능한 코드와 함께 설명되며, 발생 가능한 오류와 해결 방법도 함께 다룹니다.

---

## 대상 독자

이 책은 다음과 같은 독자를 대상으로 합니다:

- **.NET/C# 경력 10년 이상의 개발자**
- **C 언어 경험이 없거나 적은 개발자**
- **커널 드라이버 개발 경험이 없는 개발자**
- **파일 시스템 수준의 보안 솔루션에 관심 있는 개발자**

### 왜 10년 경력인가?

"10년"이라는 숫자가 중요한 것은 아닙니다. 다만, 충분한 경력의 .NET 개발자라면 이미 다음과 같은 기반을 갖추고 있을 것입니다:

```
10년 경력 .NET 개발자라면...
├── 메모리 관리 개념 이해
│   └── GC 동작 원리, 메모리 누수 경험, IDisposable 패턴
├── 멀티스레딩/동기화 경험
│   └── lock, Monitor, SemaphoreSlim, 동시성 버그 디버깅
├── 디버깅 능력 보유
│   └── Visual Studio 디버거 숙달, 덤프 분석 경험
├── 시스템 프로그래밍 기초 이해
│   └── P/Invoke, 레지스트리, 윈도우 서비스
└── 새로운 패러다임 학습 능력
    └── 기술 변화에 적응한 경험
```

이러한 기반이 있다면, 커널 개발로의 전환이 완전한 새로운 시작이 아닌 **확장**이 될 수 있습니다.

### 이 책이 맞지 않는 독자

- 프로그래밍을 처음 시작하는 분
- C#/Java/Python 등 어떤 언어로도 프로그래밍 경험이 없는 분
- Windows 운영체제에 익숙하지 않은 분

---

## 이 책에서 다루는 내용

### 핵심 주제

| Part | 주제 | 설명 |
|------|------|------|
| Part 1 | C 언어 기초 | .NET 개발자 관점에서의 C 언어 학습 |
| Part 2 | Windows 아키텍처 | 커널 구조, 파일 시스템, 보안 모델 |
| Part 3 | 개발 환경 | WDK 설치, 디버깅 환경 구성 |
| Part 4 | WinDbg 마스터 | 커널 디버거 완전 정복 |
| Part 5 | 첫 드라이버 | Hello World부터 시작 |
| Part 6 | Minifilter 기초 | Filter Manager, 콜백, 컨텍스트 |
| Part 7 | 콘텐츠 분석 | 파일 읽기, 패턴 감지 |
| Part 8 | DRM 구현 | 수정/삭제/이동 차단 |
| Part 9 | 사용자 모드 연동 | .NET 기반 관리 도구 |
| Part 10 | 테스트/최적화 | 품질 보증과 성능 |
| Part 11 | 배포 | 서명, 배포, 운영 |
| Part 12 | 고급 주제 | 암호화, 엔터프라이즈 |

### 최종 목표

이 책을 완독하면 **주민등록번호 패턴을 감지하여 파일을 보호하는 DRM Minifilter 드라이버**를 개발할 수 있습니다.

```
최종 결과물:
├── Minifilter 드라이버 (C)
│   ├── 파일 콘텐츠 분석
│   ├── 주민등록번호 패턴 감지
│   ├── 보호 파일 수정/삭제/이동 차단
│   └── 사용자 모드 통신
└── 관리 애플리케이션 (.NET)
    ├── 드라이버 제어
    ├── 보호 정책 관리
    └── 실시간 이벤트 모니터링
```

---

## 이 책에서 다루지 않는 내용

집중을 위해 다음 주제는 다루지 않습니다:

- **C 언어 완전 입문**: 변수, 반복문 등 기초 프로그래밍 개념은 알고 있다고 가정합니다.
- **네트워크 드라이버**: NDIS 필터 등 네트워크 관련 드라이버
- **그래픽 드라이버**: 디스플레이, GPU 관련 드라이버
- **USB/하드웨어 드라이버**: USB, PCI, 기타 하드웨어 드라이버
- **Linux 커널**: Windows 전용 내용입니다.

---

## 학습 로드맵

이 책은 순차적으로 학습하도록 설계되었습니다:

```
┌─────────────────────────────────────────────────────────────────┐
│                    학습 로드맵                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [Part 1-2: 기초 이론] ─────────────────────────────────────┐  │
│    C 언어 + Windows 커널 이해                                │  │
│    예상 소요: 충분한 시간을 갖고 학습                         │  │
│                                                             │  │
│  [Part 3-4: 개발 환경] ─────────────────────────────────────┤  │
│    WDK 설정 + WinDbg 마스터                                  │  │
│    환경 구축과 디버깅 능력 확보                               │  │
│                                                             │  │
│  [Part 5-6: 드라이버 입문] ─────────────────────────────────┤  │
│    Hello World → Minifilter 기초                             │  │
│    첫 번째 동작하는 드라이버 완성                             │  │
│                                                             │  │
│  [Part 7-8: 핵심 기능] ─────────────────────────────────────┤  │
│    패턴 감지 + DRM 구현                                      │  │
│    주민등록번호 보호 기능 완성                                │  │
│                                                             │  │
│  [Part 9-12: 완성 및 확장] ─────────────────────────────────┘  │
│    통합, 테스트, 배포, 고급 주제                              │
│    실무 적용 가능한 수준으로 완성                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 학습 팁

1. **순서대로 진행하세요**: 각 Part는 이전 Part의 지식을 전제로 합니다.
2. **코드를 직접 작성하세요**: 복사-붙여넣기보다 직접 타이핑하면 학습 효과가 높습니다.
3. **BSOD를 두려워하지 마세요**: 커널 개발에서 블루스크린은 정상적인 개발 과정입니다.
4. **반드시 VM에서 실습하세요**: 호스트 시스템에서 드라이버를 테스트하지 마세요.

---

## 예제 코드 안내

이 책의 모든 예제 코드는 GitHub 저장소에서 제공됩니다.

```
GitHub 저장소 구조:
minifilter-drm-example/
├── chapter-examples/          # 각 챕터별 예제
│   ├── ch15-hello-driver/
│   ├── ch18-first-minifilter/
│   └── ...
├── final-project/             # 최종 완성 프로젝트
│   ├── driver/                # Minifilter 드라이버
│   └── manager/               # .NET 관리 애플리케이션
└── tools/                     # 개발 편의 도구
```

### 예제 코드 사용 방법

1. 저장소 클론: `git clone [repository-url]`
2. 해당 챕터 폴더로 이동
3. Visual Studio 솔루션 파일 열기
4. 빌드 후 테스트 VM에 배포

---

## 개발 환경 요구사항

### 개발 머신 (호스트)

| 항목 | 최소 요구사항 | 권장 사항 |
|------|-------------|----------|
| 운영체제 | Windows 10 64-bit | Windows 11 64-bit |
| CPU | 4코어 이상 | 8코어 이상 |
| RAM | 16GB | 32GB |
| 저장소 | SSD 100GB | SSD 256GB |
| 가상화 | Hyper-V 또는 VMware | Hyper-V |

### 필수 소프트웨어

```
개발 머신 설치 목록:
├── Visual Studio 2022
│   └── Desktop development with C++ 워크로드
├── Windows SDK (최신 버전)
├── Windows Driver Kit (WDK)
├── WinDbg Preview (Microsoft Store)
└── Hyper-V 또는 VMware Workstation
```

### 테스트 VM

```
테스트 VM 구성:
├── Windows 10/11 64-bit
├── 테스트 모드 활성화 (bcdedit)
├── 네트워크 디버깅 구성
├── 최소 4GB RAM
└── 스냅샷 생성 필수
```

---

## 표기 규칙

### 난이도 표시

각 섹션에는 난이도가 표시됩니다:

| 표시 | 난이도 | 설명 |
|------|--------|------|
| ⭐ | 입문 | 기초 개념, 쉽게 이해 가능 |
| ⭐⭐ | 초급 | 약간의 집중이 필요 |
| ⭐⭐⭐ | 중급 | 핵심 내용, 충분한 학습 필요 |
| ⭐⭐⭐⭐ | 중상급 | 심화 내용, 경험 필요 |
| ⭐⭐⭐⭐⭐ | 고급 | 전문가 수준 |

### 코드 블록

C 코드와 C# 대응 코드를 함께 제시합니다:

```c
// C 언어 - 문자열 복사
// C language - String copy
char dest[256];
strcpy_s(dest, sizeof(dest), "Hello");
```

```csharp
// C# - 문자열 할당
// C# - String assignment
string dest = "Hello";
```

### 용어 표기

- 영문 용어는 처음 등장 시 한글 번역과 함께 표기합니다.
- 예: "Filter Manager (필터 관리자)"
- 이후에는 더 일반적인 표현을 사용합니다.

### 참조 표기

- 다른 챕터 참조: "Chapter 15 참조"
- 공식 문서: [Microsoft Docs 링크]
- 부록: "부록 A 참조"

---

## 주의사항

### 안전 수칙

> ⚠️ **경고**: 커널 드라이버는 시스템의 가장 높은 권한으로 실행됩니다. 잘못된 코드는 시스템 전체를 멈추게 할 수 있습니다.

1. **반드시 가상 머신에서 테스트**: 호스트 시스템에서 개발 중인 드라이버를 절대 실행하지 마세요.
2. **스냅샷 활용**: 테스트 전 항상 VM 스냅샷을 생성하세요.
3. **점진적 테스트**: 작은 변경 후 바로 테스트하세요.
4. **로그 활용**: DbgPrint/KdPrint로 상태를 확인하세요.

### BSOD (블루스크린)에 대하여

커널 개발에서 BSOD는 **정상적인 개발 과정**입니다. 두려워하지 마세요.

```
BSOD 발생 시 대응:
1. 당황하지 않는다
2. 버그 체크 코드를 기록한다 (예: DRIVER_IRQL_NOT_LESS_OR_EQUAL)
3. 크래시 덤프를 수집한다
4. WinDbg로 분석한다
5. 원인을 수정하고 다시 테스트한다
```

이 과정을 반복하며 드라이버의 안정성을 높여갑니다.

---

## 감사의 글

이 책이 완성되기까지 많은 분들의 도움이 있었습니다.

- Windows Driver 개발 커뮤니티의 선배 개발자들
- OSR Online 포럼의 전문가들
- Microsoft WDK 팀의 문서와 샘플 코드
- 그리고 이 책을 선택해주신 독자 여러분

커널 개발의 세계로 들어서는 것은 쉽지 않은 결정입니다. 하지만 그 여정의 끝에서 여러분은 시스템의 가장 깊은 곳에서 동작하는 코드를 작성할 수 있는 개발자가 되어 있을 것입니다.

함께 시작해봅시다.

---

**저자 드림**
